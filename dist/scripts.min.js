let pokemonRepository = (function () {
  let e = [],
    t = "https://pokeapi.co/api/v2/pokemon/",
    n = 0;
  function o(e) {
    return e.charAt(0).toUpperCase() + e.slice(1);
  }
  function i(t) {
    "object" == typeof t && "name" in t
      ? ((t.name = o(t.name)), e.push(t))
      : console.error("Invalid Pok\xe9mon name");
  }
  function l() {
    return e;
  }
  function r(e) {
    let t = document.querySelector(".pokemon-list"),
      n = document.createElement("li");
    n.classList.add("list-group-item");
    let o = document.createElement("button");
    (o.type = "button"),
      (o.innerHTML = e.name),
      o.classList.add("btn"),
      o.setAttribute("data-bs-toggle", "modal"),
      o.setAttribute("data-bs-target", "#pokemonModal"),
      o.addEventListener("click", function () {
        c(e);
      }),
      n.appendChild(o),
      t.appendChild(n);
  }
  function a() {
    return (
      d(),
      fetch(`${t}?limit=20&offset=${n}`)
        .then(function (e) {
          return e.json();
        })
        .then(function (e) {
          e.results.forEach(function (e) {
            i({ name: e.name, detailsUrl: e.url });
          }),
            (n += 20),
            u();
        })
        .catch(function (e) {
          console.error("Failed to load Pok\xe9mon list:", e), u();
        })
    );
  }
  function s() {
    return (
      d(),
      fetch(`${t}?limit=20&offset=${n}`)
        .then(function (e) {
          return e.json();
        })
        .then(function (e) {
          if (0 === e.results.length) {
            console.log("No more Pok\xe9mon to load");
            return;
          }
          e.results.forEach(function (e) {
            let t = { name: e.name, detailsUrl: e.url };
            i(t), r(t);
          }),
            (n += 20),
            u();
        })
        .catch(function (e) {
          console.error("Failed to load Pok\xe9mon list:", e), u();
        })
    );
  }
  function c(e) {
    var t;
    ((t = e),
    d(),
    fetch(t.detailsUrl)
      .then(function (e) {
        return e.json();
      })
      .then(function (e) {
        (t.imageUrl = e.sprites.front_default),
          (t.height = e.height),
          (t.weight = e.weight),
          (t.types = e.types),
          u();
      })
      .catch(function (e) {
        console.error("Failed to load Pok\xe9mon details:", e), u();
      })).then(function () {
      m(e);
    });
  }
  function d() {
    document.querySelector(".loading-message").innerText = "Loading...";
  }
  function u() {
    document.querySelector(".loading-message").innerText = "";
  }
  function m(e) {
    var t, n, i;
    let l = document.querySelector(".modal-image"),
      r = document.querySelector(".modal-title"),
      a = document.querySelector(".modal-height"),
      s = document.querySelector(".modal-weight"),
      c = document.querySelector(".modal-types");
    (l.src = e.imageUrl),
      (l.alt = `Image of ${e.name}`),
      (r.innerText = e.name),
      (a.innerHTML = `Height: <span class="bold">${
        parseInt((t = e.height), 10) / 10
      } m</span>`),
      (s.innerHTML = `Weight: <span class="bold">${
        parseInt((n = e.weight), 10) / 10
      } kg</span>`),
      (c.innerHTML = `Types: <span class="bold">${(i = e.types)
        .map((e) => o(e.type.name))
        .join(", ")}</span>`);
    let d = document.getElementById("pokemonModal");
    d.classList.add("show");
  }
  function f(t) {
    p(e.filter((e) => e.name.toLowerCase().includes(t.toLowerCase())));
  }
  function p(e) {
    (document.querySelector(".pokemon-list").innerHTML = ""),
      e.forEach((e) => r(e));
  }
  document
    .querySelector("#pokemon-search")
    .addEventListener("input", function (e) {
      f(e.target.value);
    });
  let h = document.getElementById("btn-back-to-top");
  return (
    window.addEventListener("scroll", function () {
      window.scrollY > 300
        ? (h.style.display = "block")
        : (h.style.display = "none");
    }),
    h.addEventListener("click", function () {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }),
    a().then(function () {
      pokemonRepository.getAll().forEach(function (e) {
        pokemonRepository.addListItem(e);
      });
    }),
    document.getElementById("load-more").addEventListener("click", s),
    {
      getAll: l,
      add: i,
      addListItem: r,
      loadInitialList: a,
      loadMoreList: s,
      showDetails: c,
      showModal: m,
      renderList: p,
      searchPokemon: f,
    }
  );
})();
